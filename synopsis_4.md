##### Кобяшова Дарья Александровна 3 курс 4 группа ИВТ

#### Конспект лекции №4

# SeLinux

<ins>**SeLinux**</ins> — это система принудительного контроля доступа, реализованная на уровне ядра. Впервые эта система появилась в четвертой версии CentOS, а в 5 и 6 версии реализация была существенно дополнена и улучшена.

<ins>**Домен**</ins> — список действий, которые может выполнять процесс. Обычно в качестве домена определяется минимально-возможный набор действий, при помощи которых процесс способен функционировать. 

<ins>**Роль**</ins> — список *доменов*, которые могут быть применены. Если какого-то домена нет в списке доменов какой-то роли, то действия из этого домена не могут быть применены.

<ins>**Тип**</ins> — набор действий, которые допустимы по отношения к объекту. Тип отличается от *домена* тем, что он может применяться к пайпам, каталогам и файлам, в то время как домен применяется к процессам.

<ins>**Контекст безопасности**</ins> — все атрибуты SELinux — роли, типы и домены.

SELinux следует модели минимально необходимых привилегий для каждого сервиса, пользователя и программы намного более строго. По умолчанию установлен <ins>**«запретительный режим»**</ins>, когда каждый элемент системы имеет только те права, которые жизненно необходимы ему для функционирования. Если же пользователь, программа или сервис пытаются изменить файл или получить доступ к ресурсу, который явно не необходим для решения их, то им будет просто отказано в доступе, а такая попытка будет зарегистрирована в журнале.

SELinux реализована на уровне **ядра**, так что прикладные приложения могут совсем ничего не знать о версии этой системы принудительного контроля доступа, особенностях её работы и т.д. В случае грамотной настройки, SELinux никак НЕ повлияет на функционирование сторонних программ и сервисов. 


Вот несколько примеров **использования** SELinux, которые позволяют увидеть, каким образом можно увеличить степень безопасности всей системы:

- Создание и настройка списка программ, которые могут читать ssh-ключи.

- Предотвращение несанкционированного доступа к данным через mail-клиент.

- Настройка браузера таким образом, чтобы он мог читать в домашней папки пользователя только необходимые для функционирования файлы и папки.
  

SELinux имеет <ins>**три основных режим работы**</ins>, при этом по умолчанию установлен режим Enforcing. Это довольно жесткий режим, и в случае необходимости он может быть изменен на более удобный для конечного пользователя.

- **Enforcing**: Режим по-умолчанию. При выборе этого режима все действия, которые каким-то образом нарушают текущую политику безопасности, будут блокироваться, а попытка нарушения будет зафиксирована в журнале.

- **Permissive**: В случае использования этого режима, информация о всех действиях, которые нарушают текущую политику безопасности, будут зафиксированы в журнале, но сами действия не будут заблокированы.

- **Disabled**: Полное отключение системы принудительного контроля доступа.


Как отмечалось ранее, SELinux по-умолчанию работает в режиме **Enforcing**, когда любые действия, кроме разрешенных, автоматически блокируются, каждая программа, пользователь или сервис обладают только теми привилегиями, которые необходимы им для функционирования, но не более того. 

Это довольно жесткая политика, которая обладает как **плюсами** — наибольший уровень информационной безопасности, так и **минусами** — конфигурирование системы в таком режиме сопряжено с большими трудозатратами *системных администраторов*, к тому же, велик риск того, что пользователи столкнутся с ограничением доступа, если захотят использовать систему хоть сколько-нибудь нетривиальным образом. Такой подход допустим в Enterprise-секторе, но неприемлем на компьютерах конечных пользователей.


SELinux предоставляет следующие <ins>**модели управления доступом**</ins>:

- Type Enforcement (TE): основной механизм контроля доступа, используемый в целевых политиках. Позволяет детально, на самом низком уровне управлять разрешениями. Самый гибкий, но и самый трудоемкий для системного администратора механизм.

- Role-Based Access Control (RBAC): в этой модели права доступа реализуются в качестве ролей. Ролью называется разрешения на выполнение определенных действий одним или несколькими элементами системы над другими частями системы. По-сути, RBAC является дальнейшим развитием TE.

- Multi-Level Security (MLS): многоуровневая модель безопасности, в которой всем объектам системы присваивается определенный уровень доступа. Разрешение или запрет доступа определяется только соотношением этих уровней.


Рано или поздно вы сталкиваетесь с ситуацией, когда SELinux запрещает вам доступ к чему-то. Есть несколько основных <ins>**причин отказа доступа**</ins>:

- Неправильно маркированный файл.

- Процесс работает в неправильном контексте

- Ошибка в политике. Процесс требует доступ к файлу, который не был учтен при создании политики.

- Попытка вторжения.

*Первые три причины* отказа доступа разрешаются достаточно легко, в то время как во время попытки вторжения звучит сигнал тревоги и пользователю посылается соответствующее уведомление.

Для того, чтобы разобраться с любой проблемой, достаточно просмотреть **журнал SELinux**. По умолчанию он записывается процессом auditd в файл /var/log/audit/audit.log. Если этот процесс не запущен, то SELinux ведет журнал в файле /var/log/messages, в этом случае все сообщения системы контроля доступа маркируются ключом AVC, что позволяет быстро отфильтровать нужные строки, например при помощи команды grep.


# Основыне команды

Команда **«chcon»** позволяет изменяет контекст SELinux для файлов или каталогов точно таким же образом, как команды **«chown»** и **«chmod»** позволяют менять владельца файла или права доступа к нему в рамках стандартной системы контроля доступа.

Команда **«restorecon»** позволяет изменить контекст безопасности на тот, который был присвоен по-умолчанию. Следует обратить внимание, что при копировании (команда cp) контекст безопасности файла будет совпадать с контекстом каталога назначения, при перемещении же, контекст безопасности будет совпадать с контекстом источника.

Для того, чтобы автоматически переразметить файловую систему при следующей перезагрузке, введите следующие команды: 
**«touch /.autorelabel»**
**«reboot»**

Иногда автоматическая переразметка не срабатывает. В таком случае воспользуйтесь следующей командой:
**«genhomedircon»**
**«touch /.autorelabel»**
**«reboot»**

Добавить правило мы можем при помощи команды **«semanage»**

Полный список портов, к которым SELinux предоставляет доступ, можно просмотреть следующим образом: **«semanage port -l»**
